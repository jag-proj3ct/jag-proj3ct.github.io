<!DOCTYPE html>
<html lang="en">
<head>
  <title>Domingo Gutierrez Ramos JAG 9th 2025</title>
</head>
<body>
  <div class="container-first">

    <div class="card profile-card">
      <div class="profile-pic-wrapper">
        <img src="images/meee.png" alt="Profile" class="profile">
        <img src="images/frame.png" alt="Kanye Frame" class="frame">
      </div>
      <a href="mailto:2029.Domingo.Gutierrez-Ramos@fps.org?subject=Website%20Inquiry%20from%20Profile">Domingo Gutierrez Ramos</a>
      <p>JAG 9th Â· 15 years old</p>
    
      <h1>THE VOTE COUNT</h1>
      
      <div class="stats">
        <p>Current Votes: <span id="currentVotes">...Loading...</span></p>
      </div>

      <button id="voteBtn">Vote Domingo!</button>
      <p id="voteMessage" style="color: #FFD700; margin-top: 10px; display: none;">Thank you for voting!</p>
      <a href="">LINK TO PROMOTIONAL VIDEO</a>

      
    </div>
  </div>
  
  <script src="js/music-player.js" defer></script>
  <script>
    // PASTE YOUR GOOGLE APPS SCRIPT WEB APP URL HERE
    const SCRIPT_URL = "YOUR_APPS_SCRIPT_WEB_APP_URL_HERE"; 
    const VOTE_KEY = "hasVotedDomingo";

    const voteBtn = document.getElementById("voteBtn");
    const votesDisplay = document.getElementById("currentVotes");
    const voteMessage = document.getElementById("voteMessage");

    // 1. Fetch current votes on load
    async function fetchVotes() {
      try {
        const response = await fetch(SCRIPT_URL, { method: 'GET' });
        const count = await response.text();
        votesDisplay.textContent = count;
      } catch (error) {
        console.error("Error fetching votes:", error);
        votesDisplay.textContent = "Error";
      }
    }

    // 2. Check if the user has already voted
    function checkVotedStatus() {
      if (localStorage.getItem(VOTE_KEY) === "true") {
        voteBtn.disabled = true;
        voteBtn.textContent = "Voted!";
        voteMessage.style.display = 'block';
      } else {
        voteBtn.disabled = false;
        voteBtn.textContent = "Vote Domingo!";
        voteMessage.style.display = 'none';
      }
    }

    // 3. Handle the one-time vote
    async function handleVote() {
      if (localStorage.getItem(VOTE_KEY) === "true") return; // Safety check

      voteBtn.disabled = true;
      voteBtn.textContent = "Submitting...";

      try {
        // Send a POST request to increment the vote count
        const response = await fetch(SCRIPT_URL, { 
          method: 'POST', 
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
        });
        
        const newCount = await response.text();
        votesDisplay.textContent = newCount;

        // Mark as voted in local storage
        localStorage.setItem(VOTE_KEY, "true");
        checkVotedStatus();

      } catch (error) {
        console.error("Error submitting vote:", error);
        alert("Failed to cast vote. Please try again later.");
        checkVotedStatus(); // Re-enable button on error
      }
    }

    // Initial load calls
    fetchVotes();
    checkVotedStatus();
    voteBtn.addEventListener("click", handleVote);
  </script>
</body>
</html>
