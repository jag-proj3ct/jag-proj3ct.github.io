// Code.gs (Google Apps Script)

// CRITICAL: This is your explicit Spreadsheet ID
const SPREADSHEET_ID = '1anGNXbaR9fIlyqXR0eIplGMqoHHDVi9o15o8G0PP30U'; 

// CRITICAL: This confirms the tab name at the bottom of your sheet
const SHEET_NAME = 'vote-data'; 

function doGet(e) {
  // Use openById to guarantee connection to the correct spreadsheet
  const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
  const sheet = ss.getSheetByName(SHEET_NAME);
  
  if (!sheet) {
    // This will return an explicit error if the tab name is wrong
    return ContentService.createTextOutput("Error: Sheet tab not found. Check SHEET_NAME variable.").setMimeType(ContentService.MimeType.TEXT);
  }
  
  // Get the value from B1
  const voteCount = sheet.getRange('B1').getValue();
  
  // Return the current vote count
  return ContentService.createTextOutput(voteCount.toString()).setMimeType(ContentService.MimeType.TEXT);
}

function doPost(e) {
  // Use openById to guarantee connection to the correct spreadsheet
  const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
  const sheet = ss.getSheetByName(SHEET_NAME);
  
  if (!sheet) {
    return ContentService.createTextOutput("Error: Sheet tab not found. Check SHEET_NAME variable.").setMimeType(ContentService.MimeType.TEXT);
  }
  
  // Target the vote count cell (B1)
  const voteCountRange = sheet.getRange('B1');
  let currentVotes = voteCountRange.getValue();
  
  // Ensure the value is treated as a number before incrementing
  if (typeof currentVotes !== 'number') {
    currentVotes = parseInt(currentVotes) || 0;
  }
  
  // Increment the vote count
  currentVotes += 1;
  voteCountRange.setValue(currentVotes);
  
  // Return the new vote count
  return ContentService.createTextOutput(currentVotes.toString()).setMimeType(ContentService.MimeType.TEXT);
}
